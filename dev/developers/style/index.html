<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Style Guide · Express.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://MineralsCloud.github.io/Express.jl/developers/style/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Express.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Express.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../installation/">Installation guide</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Running</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../run/configuration/">Configuration files</a></li><li><a class="tocitem" href="../../run/cli/">How to run <code>Express</code> from command line</a></li><li><a class="tocitem" href="../../run/jobs/">Tracking and monitoring jobs in a workflow</a></li></ul></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="../contributing/">Contributing</a></li><li class="is-active"><a class="tocitem" href>Style Guide</a><ul class="internal"><li><a class="tocitem" href="#Style-guide"><span>Style guide</span></a></li><li><a class="tocitem" href="#Design-principles"><span>Design principles</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Docs</a></li><li class="is-active"><a href>Style Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Style Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/MineralsCloud/Express.jl/blob/master/docs/src/developers/style.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="style"><a class="docs-heading-anchor" href="#style">Style guide and design principles</a><a id="style-1"></a><a class="docs-heading-anchor-permalink" href="#style" title="Permalink"></a></h1><ul><li><a href="#style">Style guide and design principles</a></li><li class="no-marker"><ul><li><a href="#Style-guide">Style guide</a></li><li><a href="#Design-principles">Design principles</a></li></ul></li></ul><h2 id="Style-guide"><a class="docs-heading-anchor" href="#Style-guide">Style guide</a><a id="Style-guide-1"></a><a class="docs-heading-anchor-permalink" href="#Style-guide" title="Permalink"></a></h2><p>This section describes the coding style rules that apply to our code and that we recommend you to use it also.</p><p>In some cases, our style guide diverges from the <a href="https://docs.julialang.org/en/v1/manual/style-guide/">Julia style guide</a> (Please read it!). All such cases will be explicitly noted and justified.</p><p>Our style guide adopts many recommendations from the <a href="https://github.com/invenia/BlueStyle">Blue style guide</a>.</p><p>Please read the <a href="https://github.com/invenia/BlueStyle">Blue style guide</a> before contributing to this package. If not following, your pull requests may not be accepted.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>The style guide is always a work in progress, and not all Express code follows the rules. When modifying Express, please fix the style violations of the surrounding code (i.e., leave the code tidier than when you started). If large changes are needed, consider separating them into another pull request.</p></div></div><h3 id="formatter"><a class="docs-heading-anchor" href="#formatter">Run <code>JuliaFormatter</code></a><a id="formatter-1"></a><a class="docs-heading-anchor-permalink" href="#formatter" title="Permalink"></a></h3><p><code>Express</code> uses <a href="https://github.com/domluna/JuliaFormatter.jl"><code>JuliaFormatter</code></a> as an auto-formatting tool.</p><p>We use the options contained in <a href="https://github.com/MineralsCloud/Express.jl/blob/master/.JuliaFormatter.toml"><code>.JuliaFormatter.toml</code></a>.</p><p>To format your code, <code>cd</code> to the <code>Express</code> directory, then run:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Pkg</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; Pkg.add(&quot;JuliaFormatter&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">   Resolving package versions...
   Installed Crayons ──────── v4.1.1
   Installed Tokenize ─────── v0.5.24
   Installed URIs ─────────── v1.4.1
   Installed Glob ─────────── v1.3.0
   Installed CommonMark ───── v0.8.7
   Installed JuliaFormatter ─ v1.0.15
   Installed CSTParser ────── v3.3.6
    Updating `~/work/Express.jl/Express.jl/docs/build/developers/Project.toml`
  [98e50ef6] + JuliaFormatter v1.0.15
    Updating `~/work/Express.jl/Express.jl/docs/build/developers/Manifest.toml`
  [00ebfdb7] + CSTParser v3.3.6
  [a80b9123] + CommonMark v0.8.7
  [34da2185] + Compat v4.4.0
  [a8cc5b0e] + Crayons v4.1.1
  [864edb3b] + DataStructures v0.18.13
  [c27321d9] + Glob v1.3.0
  [682c06a0] + JSON v0.21.3
  [98e50ef6] + JuliaFormatter v1.0.15
  [bac558e1] + OrderedCollections v1.4.1
  [69de0a69] + Parsers v2.5.1
  [66db9d55] + SnoopPrecompile v1.0.1
  [0796e94c] + Tokenize v0.5.24
  [5c2747f8] + URIs v1.4.1
  [0dad84c5] + ArgTools v1.1.1
  [56f22d72] + Artifacts
  [2a0f44e3] + Base64
  [ade2ca70] + Dates
  [f43a241f] + Downloads v1.6.0
  [7b1f6079] + FileWatching
  [b77e0a4c] + InteractiveUtils
  [b27032c2] + LibCURL v0.6.3
  [76f85450] + LibGit2
  [8f399da3] + Libdl
  [37e2e46d] + LinearAlgebra
  [56ddb016] + Logging
  [d6f4376e] + Markdown
  [a63ad114] + Mmap
  [ca575930] + NetworkOptions v1.2.0
  [44cfe95a] + Pkg v1.8.0
  [de0858da] + Printf
  [3fa0cd96] + REPL
  [9a3f8284] + Random
  [ea8e919c] + SHA v0.7.0
  [9e88b42a] + Serialization
  [6462fe0b] + Sockets
  [fa267f1f] + TOML v1.0.0
  [a4e569a6] + Tar v1.10.1
  [cf7118a7] + UUIDs
  [4ec0a83e] + Unicode
  [e66e0078] + CompilerSupportLibraries_jll v0.5.2+0
  [deac9b47] + LibCURL_jll v7.84.0+0
  [29816b5a] + LibSSH2_jll v1.10.2+0
  [c8ffd9c3] + MbedTLS_jll v2.28.0+0
  [14a3606d] + MozillaCACerts_jll v2022.2.1
  [4536629a] + OpenBLAS_jll v0.3.20+0
  [83775a58] + Zlib_jll v1.2.12+3
  [8e850b90] + libblastrampoline_jll v5.1.1+0
  [8e850ede] + nghttp2_jll v1.48.0+0
  [3f19e933] + p7zip_jll v17.4.0+0
Precompiling project...
<span class="sgr32">  ✓ </span><span class="sgr90">URIs</span>
<span class="sgr32">  ✓ </span><span class="sgr90">Glob</span>
<span class="sgr32">  ✓ </span><span class="sgr90">Crayons</span>
<span class="sgr32">  ✓ </span><span class="sgr90">Tokenize</span>
<span class="sgr32">  ✓ </span><span class="sgr90">CommonMark</span>
<span class="sgr32">  ✓ </span><span class="sgr90">CSTParser</span>
<span class="sgr32">  ✓ </span>JuliaFormatter
  7 dependencies successfully precompiled in 8 seconds. 12 already precompiled.</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; using JuliaFormatter: format</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; format(&quot;docs&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: IOError: realpath(&quot;docs&quot;): no such file or directory (ENOENT)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; format(&quot;src&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: IOError: realpath(&quot;src&quot;): no such file or directory (ENOENT)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; format(&quot;test&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: IOError: realpath(&quot;test&quot;): no such file or directory (ENOENT)</code></pre><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>A continuous integration check verifies that all PRs made to <code>Express</code> have passed the formatter.</p></div></div><p>The following sections outline extra style guide points that are not fixed automatically by <code>JuliaFormatter</code>.</p><h3 id="Use-the-Julia-extension-for-Visual-Studio-Code"><a class="docs-heading-anchor" href="#Use-the-Julia-extension-for-Visual-Studio-Code">Use the Julia extension for Visual Studio Code</a><a id="Use-the-Julia-extension-for-Visual-Studio-Code-1"></a><a class="docs-heading-anchor-permalink" href="#Use-the-Julia-extension-for-Visual-Studio-Code" title="Permalink"></a></h3><p>Please use <a href="https://code.visualstudio.com/">VS Code</a> with the <a href="https://marketplace.visualstudio.com/items?itemName=julialang.language-julia">Julia extension</a> to edit, format, and test your code. We do not recommend using other editors to edit your code for the time being.</p><p>This extension already has <a href="https://github.com/domluna/JuliaFormatter.jl"><code>JuliaFormatter</code></a> integrated. So to format your code, follow the steps listed <a href="https://www.julia-vscode.org/docs/stable/userguide/formatter/">here</a>.</p><h2 id="Design-principles"><a class="docs-heading-anchor" href="#Design-principles">Design principles</a><a id="Design-principles-1"></a><a class="docs-heading-anchor-permalink" href="#Design-principles" title="Permalink"></a></h2><p>We adopt some <a href="https://sciml.ai/"><code>SciML</code></a> design <a href="https://github.com/SciML/SciMLStyle">guidelines</a> here. Please read it before contributing!</p><h3 id="Consistency-vs-Adherence"><a class="docs-heading-anchor" href="#Consistency-vs-Adherence">Consistency vs Adherence</a><a id="Consistency-vs-Adherence-1"></a><a class="docs-heading-anchor-permalink" href="#Consistency-vs-Adherence" title="Permalink"></a></h3><p>According to PEP8:</p><blockquote><p>A style guide is about consistency. Consistency with this style guide is important. Consistency within a project is more important. Consistency within one module or function is the most important.</p></blockquote><blockquote><p>But most importantly: know when to be inconsistent – sometimes the style guide just doesn&#39;t apply. When in doubt, use your best judgment. Look at other examples and decide what looks best. And don&#39;t hesitate to ask!</p></blockquote><h3 id="Community-Contribution-Guidelines"><a class="docs-heading-anchor" href="#Community-Contribution-Guidelines">Community Contribution Guidelines</a><a id="Community-Contribution-Guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#Community-Contribution-Guidelines" title="Permalink"></a></h3><p>For a comprehensive set of community contribution guidelines, refer to <a href="https://github.com/SciML/ColPrac">ColPrac</a>. A relevant point to highlight PRs should do one thing. In the context of style, this means that PRs which update the style of a package&#39;s code should not be mixed with fundamental code contributions. This separation makes it easier to ensure that large style improvement are isolated from substantive (and potentially breaking) code changes.</p><h3 id="Open-source-contributions-are-allowed-to-start-small-and-grow-over-time"><a class="docs-heading-anchor" href="#Open-source-contributions-are-allowed-to-start-small-and-grow-over-time">Open source contributions are allowed to start small and grow over time</a><a id="Open-source-contributions-are-allowed-to-start-small-and-grow-over-time-1"></a><a class="docs-heading-anchor-permalink" href="#Open-source-contributions-are-allowed-to-start-small-and-grow-over-time" title="Permalink"></a></h3><p>If the standard for code contributions is that every PR needs to support every possible input type that anyone can think of, the barrier would be too high for newcomers. Instead, the principle is to be as correct as possible to begin with, and grow the generic support over time. All recommended functionality should be tested, any known generality issues should be documented in an issue (and with a <code>@test_broken</code> test when possible). However, a function which is known to not be GPU-compatible is not grounds to block merging, rather it is an encouragement for a follow-up PR to improve the general type support!</p><h3 id="Generic-code-is-preferred-unless-code-is-known-to-be-specific"><a class="docs-heading-anchor" href="#Generic-code-is-preferred-unless-code-is-known-to-be-specific">Generic code is preferred unless code is known to be specific</a><a id="Generic-code-is-preferred-unless-code-is-known-to-be-specific-1"></a><a class="docs-heading-anchor-permalink" href="#Generic-code-is-preferred-unless-code-is-known-to-be-specific" title="Permalink"></a></h3><p>For example, the code:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; function f(A, B)
           for i in 1:length(A)
               A[i] = A[i] + B[i]
           end
       end</code><code class="nohighlight hljs ansi" style="display:block;">f (generic function with 1 method)</code></pre><p>would not be preferred for two reasons. One is that it assumes <code>A</code> uses one-based indexing, which would fail in cases like <a href="https://github.com/JuliaArrays/OffsetArrays.jl"><code>OffsetArrays</code></a> and <a href="https://github.com/JuliaArrays/FFTViews.jl"><code>FFTViews</code></a>. Another issue is that it requires indexing, while not all array types support indexing (for example, <a href="https://github.com/JuliaGPU/CuArrays.jl"><code>CuArrays</code></a>). A more generic compatible implementation of this function would be to use broadcast, for example:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; function f(A, B)
           @. A = A + B
       end</code><code class="nohighlight hljs ansi" style="display:block;">f (generic function with 1 method)</code></pre><p>which would allow support for a wider variety of array types.</p><h3 id="Internal-types-should-match-the-types-used-by-users-when-possible"><a class="docs-heading-anchor" href="#Internal-types-should-match-the-types-used-by-users-when-possible">Internal types should match the types used by users when possible</a><a id="Internal-types-should-match-the-types-used-by-users-when-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-types-should-match-the-types-used-by-users-when-possible" title="Permalink"></a></h3><p>If <code>f(A)</code> takes the input of some collections and computes an output from those collections, then it should be expected that if the user gives <code>A</code> as an <code>Array</code>, the computation should be done via <code>Array</code>s. If <code>A</code> was a <code>CuArray</code>, then it should be expected that the computation should be internally done using a <code>CuArray</code> (or appropriately error if not supported). For these reasons, constructing arrays via generic methods, like <code>similar(A)</code>, is preferred when writing <code>f</code> instead of using non-generic constructors like <code>Array(undef,size(A))</code> unless the function is documented as being non-generic.</p><h3 id="Trait-definition-and-adherence-to-generic-interface-is-preferred-when-possible"><a class="docs-heading-anchor" href="#Trait-definition-and-adherence-to-generic-interface-is-preferred-when-possible">Trait definition and adherence to generic interface is preferred when possible</a><a id="Trait-definition-and-adherence-to-generic-interface-is-preferred-when-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Trait-definition-and-adherence-to-generic-interface-is-preferred-when-possible" title="Permalink"></a></h3><p>Julia provides many interfaces, for example:</p><ul><li><a href="https://docs.julialang.org/en/v1/manual/interfaces/#man-interface-iteration">Iteration</a></li><li><a href="https://docs.julialang.org/en/v1/manual/interfaces/#Indexing">Indexing</a></li><li><a href="https://docs.julialang.org/en/v1/manual/interfaces/#man-interfaces-broadcasting">Broadcast</a></li></ul><p>Those interfaces should be followed when possible. For example, when defining broadcast overloads, one should implement a <code>BroadcastStyle</code> as suggested by the documentation instead of simply attempting to bypass the broadcast system via <code>copyto!</code> overloads.</p><p>When interface functions are missing, these should be added to Base Julia or an interface package, like <a href="https://github.com/JuliaArrays/ArrayInterface.jl"><code>ArrayInterface.jl</code></a>. Such traits should be declared and used when appropriate. For example, if a line of code requires mutation, the trait <code>ArrayInterface.ismutable(A)</code> should be checked before attempting to mutate, and informative error messages should be written to capture the immutable case (or, an alternative code which does not mutate should be given).</p><p>One example of this principle is demonstrated in the generation of Jacobian matrices. In many scientific applications, one may wish to generate a Jacobian cache from the user&#39;s input <code>u0</code>. A naive way to generate this Jacobian is <code>J = similar(u0,length(u0),length(u0))</code>. However, this will generate a Jacobian <code>J</code> such that <code>J isa Matrix</code>.</p><h3 id="Macros-should-be-limited-and-only-be-used-for-syntactic-sugar"><a class="docs-heading-anchor" href="#Macros-should-be-limited-and-only-be-used-for-syntactic-sugar">Macros should be limited and only be used for syntactic sugar</a><a id="Macros-should-be-limited-and-only-be-used-for-syntactic-sugar-1"></a><a class="docs-heading-anchor-permalink" href="#Macros-should-be-limited-and-only-be-used-for-syntactic-sugar" title="Permalink"></a></h3><p>Macros define new syntax, and for this reason they tend to be less composable than other coding styles and require prior familiarity to be easily understood. One principle to keep in mind is, &quot;can the person reading the code easily picture what code is being generated?&quot;. For example, a user of Soss.jl may not know what code is being generated by:</p><pre><code class="language-julia hljs">@model (x, α) begin
    σ ~ Exponential()
    β ~ Normal()
    y ~ For(x) do xj
        Normal(α + β * xj, σ)
    end
    return y
end</code></pre><p>and thus using such a macro as the interface is not preferred when possible. However, a macro like <a href="https://github.com/SciML/MuladdMacro.jl"><code>@muladd</code></a> is trivial to picture on a code (it recursively transforms <code>a*b + c</code> to <code>muladd(a,b,c)</code> for more <a href="https://en.wikipedia.org/wiki/Multiply%E2%80%93accumulate_operation">accuracy and efficiency</a>), so using such a macro for example:</p><pre><code class="language-julia hljs">julia&gt; @macroexpand(@muladd k3 = f(t + c3 * dt, @. uprev + dt * (a031 * k1 + a032 * k2)))
:(k3 = f((muladd)(c3, dt, t), (muladd).(dt, (muladd).(a032, k2, (*).(a031, k1)), uprev)))</code></pre><p>is recommended. Some macros in this category are:</p><ul><li><code>@inbounds</code></li><li><a href="https://github.com/SciML/MuladdMacro.jl"><code>@muladd</code></a></li><li><code>@view</code></li><li><a href="https://github.com/SciML/ModelingToolkit.jl"><code>@named</code></a></li><li><code>@.</code></li><li><a href="https://github.com/YingboMa/FastBroadcast.jl"><code>@..</code></a></li></ul><p>Some performance macros, like <code>@simd</code>, <code>@threads</code>, or <a href="https://github.com/JuliaSIMD/LoopVectorization.jl"><code>@turbo</code> from <code>LoopVectorization.jl</code></a>, make an exception in that their generated code may be foreign to many users. However, they still are classified as appropriate uses as they are syntactic sugar since they do (or should) not change the behavior of the program in measurable ways other than performance.</p><h3 id="Errors-should-be-caught-as-high-as-possible,-and-error-messages-should-be-contextualized-for-newcomers"><a class="docs-heading-anchor" href="#Errors-should-be-caught-as-high-as-possible,-and-error-messages-should-be-contextualized-for-newcomers">Errors should be caught as high as possible, and error messages should be contextualized for newcomers</a><a id="Errors-should-be-caught-as-high-as-possible,-and-error-messages-should-be-contextualized-for-newcomers-1"></a><a class="docs-heading-anchor-permalink" href="#Errors-should-be-caught-as-high-as-possible,-and-error-messages-should-be-contextualized-for-newcomers" title="Permalink"></a></h3><p>Whenever possible, defensive programming should be used to check for potential errors before they are encountered deeper within a package. For example, if one knows that <code>f(u0,p)</code> will error unless <code>u0</code> is the size of <code>p</code>, this should be caught at the start of the function to throw a domain specific error, for example &quot;parameters and initial condition should be the same size&quot;.</p><h3 id="Subpackaging-and-interface-packages-is-preferred-over-conditional-modules-via-Requires.jl"><a class="docs-heading-anchor" href="#Subpackaging-and-interface-packages-is-preferred-over-conditional-modules-via-Requires.jl">Subpackaging and interface packages is preferred over conditional modules via <code>Requires.jl</code></a><a id="Subpackaging-and-interface-packages-is-preferred-over-conditional-modules-via-Requires.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Subpackaging-and-interface-packages-is-preferred-over-conditional-modules-via-Requires.jl" title="Permalink"></a></h3><p><code>Requires.jl</code> should be avoided at all costs. If an interface package exists, such as <a href="https://github.com/JuliaDiff/ChainRulesCore.jl"><code>ChainRulesCore.jl</code></a> for defining automatic differentiation rules without requiring a dependency on the whole <code>ChainRules.jl</code> system, or <a href="https://github.com/JuliaPlots/RecipesBase.jl"><code>RecipesBase.jl</code></a> which allows for defining <code>Plots.jl</code> plot recipes without a dependency on <code>Plots.jl</code>, a direct dependency on these interface packages is preferred.</p><p>Otherwise, instead of resorting to a conditional dependency using <code>Requires.jl</code>, it is preferred one creates subpackages, i.e. smaller independent packages kept within the same GitHub repository with independent versioning and package management. An example of this is seen in <a href="https://github.com/SciML/Optimization.jl"><code>Optimization.jl</code></a> which has subpackages like <a href="https://github.com/SciML/Optimization.jl/tree/master/lib/OptimizationBBO"><code>OptimizationBBO.jl</code></a> for <code>BlackBoxOptim.jl</code> support.</p><p>Some important interface packages to know about are:</p><ul><li><a href="https://github.com/JuliaDiff/ChainRulesCore.jl"><code>ChainRulesCore.jl</code></a></li><li><a href="https://github.com/JuliaPlots/RecipesBase.jl"><code>RecipesBase.jl</code></a></li><li><a href="https://github.com/JuliaArrays/ArrayInterface.jl"><code>ArrayInterface.jl</code></a></li><li><a href="https://github.com/SciML/CommonSolve.jl"><code>CommonSolve.jl</code></a></li><li><a href="https://github.com/SciML/SciMLBase.jl"><code>SciMLBase.jl</code></a></li></ul><h3 id="Functions-should-either-attempt-to-be-non-allocating-and-reuse-caches,-or-treat-inputs-as-immutable"><a class="docs-heading-anchor" href="#Functions-should-either-attempt-to-be-non-allocating-and-reuse-caches,-or-treat-inputs-as-immutable">Functions should either attempt to be non-allocating and reuse caches, or treat inputs as immutable</a><a id="Functions-should-either-attempt-to-be-non-allocating-and-reuse-caches,-or-treat-inputs-as-immutable-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-should-either-attempt-to-be-non-allocating-and-reuse-caches,-or-treat-inputs-as-immutable" title="Permalink"></a></h3><p>Mutating codes and non-mutating codes fall into different worlds. When a code is fully immutable, the compiler can better reason about dependencies, optimize the code, and check for correctness. However, many times a code making the fullest use of mutation can outperform even what the best compilers of today can generate. That said, the worst of all worlds is when code mixes mutation with non-mutating code. Not only is this a mishmash of coding styles, it has the potential non-locality and compiler proof issues of mutating code while not fully benefiting from the mutation.</p><h3 id="Out-Of-Place-and-Immutability-is-preferred-when-sufficient-performant"><a class="docs-heading-anchor" href="#Out-Of-Place-and-Immutability-is-preferred-when-sufficient-performant">Out-Of-Place and Immutability is preferred when sufficient performant</a><a id="Out-Of-Place-and-Immutability-is-preferred-when-sufficient-performant-1"></a><a class="docs-heading-anchor-permalink" href="#Out-Of-Place-and-Immutability-is-preferred-when-sufficient-performant" title="Permalink"></a></h3><p>Mutation is used to get more performance by decreasing the amount of heap allocations. However, if it&#39;s not helpful for heap allocations in a given spot, do not use mutation. Mutation is scary and should be avoided unless it gives an immediate benefit. For example, if matrices are sufficiently large, then <code>A*B</code> is as fast as <code>mul!(C,A,B)</code>, and thus writing <code>A*B</code> is preferred (unless the rest of the function is being careful about being fully non-allocating, in which case this should be <code>mul!</code> for consistency).</p><p>Similarly, when defining types, using <code>struct</code> is preferred to <code>mutable struct</code> unless mutating the struct is a common occurrence. Even if mutating the struct is a common occurrence, see whether using <a href="https://github.com/jw3126/Setfield.jl"><code>Setfield.jl</code></a> is sufficient. The compiler will optimize the construction of immutable structs, and thus this can be more efficient if it&#39;s not too much of a code hassle.</p><h3 id="Tests-should-attempt-to-cover-a-wide-gamut-of-input-types"><a class="docs-heading-anchor" href="#Tests-should-attempt-to-cover-a-wide-gamut-of-input-types">Tests should attempt to cover a wide gamut of input types</a><a id="Tests-should-attempt-to-cover-a-wide-gamut-of-input-types-1"></a><a class="docs-heading-anchor-permalink" href="#Tests-should-attempt-to-cover-a-wide-gamut-of-input-types" title="Permalink"></a></h3><p>Code coverage numbers are meaningless if one does not consider the input types. For example, one can hit all the code with <code>Array</code>, but that does not test whether <code>CuArray</code> is compatible! Thus, it&#39;s always good to think of coverage not in terms of lines of code but in terms of type coverage. A good list of number types to think about are:</p><ul><li><code>Float64</code></li><li><code>Float32</code></li><li><code>Complex</code></li><li><a href="https://github.com/JuliaDiff/ForwardDiff.jl"><code>Dual</code></a></li><li><code>BigFloat</code></li></ul><p>Array types to think about testing are:</p><ul><li><code>Array</code></li><li><a href="https://github.com/JuliaArrays/OffsetArrays.jl"><code>OffsetArray</code></a></li><li><a href="https://github.com/JuliaGPU/CUDA.jl"><code>CuArray</code></a></li></ul><h3 id="When-in-doubt,-a-submodule-should-become-a-subpackage-or-separate-package"><a class="docs-heading-anchor" href="#When-in-doubt,-a-submodule-should-become-a-subpackage-or-separate-package">When in doubt, a submodule should become a subpackage or separate package</a><a id="When-in-doubt,-a-submodule-should-become-a-subpackage-or-separate-package-1"></a><a class="docs-heading-anchor-permalink" href="#When-in-doubt,-a-submodule-should-become-a-subpackage-or-separate-package" title="Permalink"></a></h3><p>Keep packages to one core idea. If there&#39;s something separate enough to be a submodule, could it instead be a separate well-tested and documented package to be used by other packages? Most likely yes.</p><h3 id="Globals-should-be-avoided-whenever-possible"><a class="docs-heading-anchor" href="#Globals-should-be-avoided-whenever-possible">Globals should be avoided whenever possible</a><a id="Globals-should-be-avoided-whenever-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Globals-should-be-avoided-whenever-possible" title="Permalink"></a></h3><p>Global variables should be avoided whenever possible. When required, global variables should be constants and have an all uppercase name separated with underscores (e.g. <code>MY_CONSTANT</code>). They should be defined at the top of the file, immediately after imports and exports but before an <code>__init__</code> function. If you truly want mutable global style behavior you may want to look into mutable containers.</p><h3 id="Type-stable-and-Type-grounded-code-is-preferred-wherever-possible"><a class="docs-heading-anchor" href="#Type-stable-and-Type-grounded-code-is-preferred-wherever-possible">Type-stable and Type-grounded code is preferred wherever possible</a><a id="Type-stable-and-Type-grounded-code-is-preferred-wherever-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Type-stable-and-Type-grounded-code-is-preferred-wherever-possible" title="Permalink"></a></h3><p>Type-stable and type-grounded code helps the compiler create not only more optimized code, but also faster to compile code. Always keep containers well-typed, functions specializing on the appropriate arguments, and types concrete.</p><h3 id="Closures-should-be-avoided-whenever-possible"><a class="docs-heading-anchor" href="#Closures-should-be-avoided-whenever-possible">Closures should be avoided whenever possible</a><a id="Closures-should-be-avoided-whenever-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Closures-should-be-avoided-whenever-possible" title="Permalink"></a></h3><p>Closures can cause accidental type instabilities that are difficult to track down and debug; in the long run it saves time to always program defensively and avoid writing closures in the first place, even when a particular closure would not have been problematic. A similar argument applies to reading code with closures; if someone is looking for type instabilities, this is faster to do when code does not contain closures. Furthermore, if you want to update variables in an outer scope, do so explicitly with <code>Ref</code>s or self defined structs. For example,</p><pre><code class="language-julia hljs">map(Base.Fix2(getindex, i), vector_of_vectors)</code></pre><p>is preferred over</p><pre><code class="language-julia hljs">map(v -&gt; v[i], vector_of_vectors)</code></pre><p>or</p><pre><code class="language-julia hljs">[v[i] for v in vector_of_vectors]</code></pre><h3 id="Numerical-functionality-should-use-the-appropriate-generic-numerical-interfaces"><a class="docs-heading-anchor" href="#Numerical-functionality-should-use-the-appropriate-generic-numerical-interfaces">Numerical functionality should use the appropriate generic numerical interfaces</a><a id="Numerical-functionality-should-use-the-appropriate-generic-numerical-interfaces-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-functionality-should-use-the-appropriate-generic-numerical-interfaces" title="Permalink"></a></h3><p>While you can use <code>A\b</code> to do a linear solve inside a package, that does not mean that you should. This interface is only sufficient for performing factorizations, and so that limits the scaling choices, the types of <code>A</code> that can be supported, etc. Instead, linear solves within packages should use <code>LinearSolve.jl</code>. Similarly, nonlinear solves should use <code>NonlinearSolve.jl</code>. Optimization should use <code>Optimization.jl</code>. This allows the full generic choice to be given to the user without depending on every solver package (effectively recreating the generic interfaces within each package).</p><h3 id="Functions-should-capture-one-underlying-principle"><a class="docs-heading-anchor" href="#Functions-should-capture-one-underlying-principle">Functions should capture one underlying principle</a><a id="Functions-should-capture-one-underlying-principle-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-should-capture-one-underlying-principle" title="Permalink"></a></h3><p>Functions mean one thing. Every dispatch of <code>+</code> should be &quot;the meaning of addition on these types&quot;. While in theory you could add dispatches to <code>+</code> that mean something different, that will fail in generic code for which <code>+</code> means addition. Thus, for generic code to work, code needs to adhere to one meaning for each function. Every dispatch should be an instantiation of that meaning.</p><h3 id="Internal-choices-should-be-exposed-as-options-whenever-possible"><a class="docs-heading-anchor" href="#Internal-choices-should-be-exposed-as-options-whenever-possible">Internal choices should be exposed as options whenever possible</a><a id="Internal-choices-should-be-exposed-as-options-whenever-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-choices-should-be-exposed-as-options-whenever-possible" title="Permalink"></a></h3><p>Whenever possible, numerical values and choices within scripts should be exposed as options to the user. This promotes code reusability beyond the few cases the author may have expected.</p><h3 id="Prefer-code-reuse-over-rewrites-whenever-possible"><a class="docs-heading-anchor" href="#Prefer-code-reuse-over-rewrites-whenever-possible">Prefer code reuse over rewrites whenever possible</a><a id="Prefer-code-reuse-over-rewrites-whenever-possible-1"></a><a class="docs-heading-anchor-permalink" href="#Prefer-code-reuse-over-rewrites-whenever-possible" title="Permalink"></a></h3><p>If a package has a function you need, use the package. Add a dependency if you need to. If the function is missing a feature, prefer to add that feature to said package and then add it as a dependency. If the dependency is potentially troublesome, for example because it has a high load time, prefer to spend time helping said package fix these issues and add the dependency. Only when it does not seem possible to make the package &quot;good enough&quot; should using the package be abandoned. If it is abandoned, consider building a new package for this functionality as you need it, and then make it a dependency.</p><h3 id="Prefer-to-not-shadow-functions"><a class="docs-heading-anchor" href="#Prefer-to-not-shadow-functions">Prefer to not shadow functions</a><a id="Prefer-to-not-shadow-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Prefer-to-not-shadow-functions" title="Permalink"></a></h3><p>Two functions can have the same name in Julia by having different namespaces. For example, <code>X.f</code> and <code>Y.f</code> can be two different functions, with different dispatches, but the same name. This should be avoided whenever possible. Instead of creating <code>MyPackage.sort</code>, consider adding dispatches to <code>Base.sort</code> for your types if these new dispatches match the underlying principle of the function. If it doesn&#39;t, prefer to use a different name. While using <code>MyPackage.sort</code> is not conflicting, it is going to be confusing for most people unfamiliar with your code, so <code>MyPackage.special_sort</code> would be more helpful to newcomers reading the code.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../contributing/">« Contributing</a><a class="docs-footer-nextpage" href="../../troubleshooting/">Troubleshooting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 25 November 2022 23:44">Friday 25 November 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
